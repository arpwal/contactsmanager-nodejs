# ContactsManager Node.js SDK

[![npm version](https://img.shields.io/npm/v/@contactsmanager/server.svg)](https://www.npmjs.com/package/@contactsmanager/server)
[![Build Status](https://github.com/arpwal/contactsmanager-nodejs/actions/workflows/publish.yml/badge.svg)](https://github.com/arpwal/contactsmanager-nodejs/actions/workflows/publish.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![TypeScript](https://img.shields.io/badge/TypeScript-4.9.0-blue)](https://www.typescriptlang.org/)
[![Test Coverage](https://img.shields.io/badge/coverage-100%25-brightgreen)](https://github.com/arpwal/contactsmanager-nodejs)

A Node.js SDK for the ContactsManager API that handles authentication and token generation for [contactsmanager.io](https://www.contactsmanager.io) integration.

## Overview

The ContactsManager SDK enables developers to easily integrate social features into their applications. It provides secure authentication and token management, helping you build features like activity feeds, follow/unfollow functionality, and contact management while ensuring user data privacy and security.

## Installation

```bash
npm install @contactsmanager/server
```

## Usage

```javascript
const { ContactsManagerClient } = require("@contactsmanager/server");

// Initialize the client
const client = new ContactsManagerClient({
  apiKey: "your_api_key",
  apiSecret: "your_api_secret",
  orgId: "your_org_id",
});

// Generate a token for a user
async function generateUserToken() {
  try {
    const tokenResponse = await client.generateToken({
      userId: "user123",
      deviceInfo: {
        // Optional
        deviceType: "mobile",
        os: "Android",
        appVersion: "1.0.0",
      },
    });

    console.log(`Token: ${tokenResponse.token}`);
    console.log(`Expires at: ${tokenResponse.expiresAt}`);
  } catch (error) {
    console.error("Error generating token:", error);
  }
}

generateUserToken();
```

## Features

- Simple API for generating JWT tokens for contactsmanager.io services
- TypeScript support with type definitions
- Comprehensive test coverage
- Support for custom token expiration
- Promise-based API
- Military-grade security for user data protection

## Advanced Usage

### Custom Token Expiration

By default, tokens expire after 24 hours (86400 seconds). You can customize this:

```javascript
// Generate a token that expires in 1 hour
const tokenResponse = await client.generateToken({
  userId: "user123",
  expirationSeconds: 3600, // 1 hour
});
```

### Token Structure

The tokens generated by the SDK have the following structure:

```javascript
{
  "user_id": "user123",          // User identifier
  "api_key": "your_api_key",     // Your API key
  "org_id": "your_org_id",       // Your organization ID
  "device": { /* device info */ },  // Device information (optional)
  "jti": "unique-uuid",          // JWT ID for token uniqueness
  "iat": 1617184430,             // Issued at timestamp
  "exp": 1617270830              // Expiration timestamp
}
```

## Requirements

- Node.js 14+
- jsonwebtoken >= 9.0.0

## Development

### Setting up development environment

```bash
# Clone the repository
git clone https://github.com/arpwal/contactmanager.git
cd contactmanager/sdk/nodejs

# Install dependencies
npm install

# Run tests
npm test
```

### Running integration tests

The SDK includes integration tests that verify the functionality against an actual ContactsManager API server.

To run the integration tests locally:

1. Create a `.env` file in the root directory with the following environment variable:

```
TEST_CONFIG={"apiKey":"your_api_key","apiSecret":"your_api_secret","orgId":"your_org_id","serverUrl":"https://api.contactsmanager.io"}
```

The `TEST_CONFIG` environment variable should be a JSON string containing all the required credentials:

- `apiKey`: Your ContactsManager API key
- `apiSecret`: Your ContactsManager API secret
- `orgId`: Your organization ID
- `serverUrl`: Optional server URL (defaults to https://api.contactsmanager.io)

2. Run the integration tests:

```bash
npm run test:integration
```

Note: Integration tests are also run automatically in the CI pipeline if the required environment variables are configured as GitHub secrets. In GitHub Actions, set a secret named `TEST_CONFIG` with the JSON string value as shown above.

### Releasing new versions

The SDK uses an automated process for releases:

1. Update the version in `package.json` using npm:

   ```bash
   npm version patch # or minor, or major
   ```

2. Commit and push the change to the main branch:

   ```bash
   git push origin main --follow-tags
   ```

3. The GitHub Actions workflow will automatically:
   - Run all tests
   - Build the package
   - Publish to npm (using the NPM_TOKEN stored in GitHub secrets)
   - Create a new GitHub release with the version tag

Alternatively, you can manually trigger the workflow by going to the "Actions" tab in the GitHub repository and using the "Run workflow" button on the "Build and Publish" workflow.

## License

MIT License

## About ContactsManager.io

[ContactsManager.io](https://www.contactsmanager.io) provides a platform for app developers to integrate social features into their applications. Our SDK ensures that contact information stays with users only, with multi-layer encryption and military-grade security to prevent spam and data misuse.

For more information and documentation, visit [contactsmanager.io](https://www.contactsmanager.io).
